CREATE OR REPLACE VIEW `vu_detail_ambil_paket_rawat` AS 
(select `detail_ambil_paket`.`dapaket_id` AS `dapaket_id`,`detail_ambil_paket`.`dapaket_item` AS `dapaket_item`,date_format(`detail_ambil_paket`.`dapaket_date_create`,_utf8'%Y-%m-%d') AS `tanggal`,`vu_perawatan`.`rawat_nama` AS `rawat_nama`,`vu_perawatan`.`rawat_kode` AS `rawat_kode`,`vu_perawatan`.`rawat_id` AS `rawat_id`,`vu_perawatan`.`kategori_nama` AS `kategori_nama`,`detail_ambil_paket`.`dapaket_jumlah` AS `dapaket_jumlah`,`pemakai`.`cust_nama` AS `pemakai_nama`,if((isnull(`terapis`.`karyawan_username`) and isnull(`dokter`.`karyawan_username`)),`referal`.`karyawan_username`,if((`tindakan_detail`.`dtrawat_petugas1` = 0),if((`tindakan_detail`.`dtrawat_petugas2` = 0),NULL,`terapis`.`karyawan_username`),`dokter`.`karyawan_username`)) AS `referal`,`detail_ambil_paket`.`dapaket_stat_dok` AS `dapaket_stat_dok`,`master_jual_paket`.`jpaket_cust` AS `jpaket_cust`,`customer`.`cust_id` AS `cust_id`,`master_jual_paket`.`jpaket_tanggal` AS `tanggal_beli`,`master_jual_paket`.`jpaket_nobukti` AS `no_bukti`,`customer`.`cust_no` AS `cust_no`,`customer`.`cust_nama` AS `cust_nama`,`paket`.`paket_kode` AS `paket_kode`,`paket`.`paket_nama` AS `paket_nama`,`detail_ambil_paket`.`dapaket_paket` AS `dapaket_paket`,`master_jual_paket`.`jpaket_stat_dok` AS `jpaket_stat_dok`,((((((`detail_jual_paket`.`dpaket_harga` * (100 - `detail_jual_paket`.`dpaket_diskon`)) / 100) * `detail_jual_paket`.`dpaket_jumlah`) - (((`master_jual_paket`.`jpaket_diskon` * ((`detail_jual_paket`.`dpaket_harga` * (100 - `detail_jual_paket`.`dpaket_diskon`)) / 100)) * `detail_jual_paket`.`dpaket_jumlah`) / 100)) / `detail_jual_paket`.`dpaket_jumlah`) / `vu_jumlah_isi_paket`.`isi_paket`) AS `harga_satuan`,`detail_ambil_paket`.`dapaket_keterangan` AS `dapaket_keterangan` from (((((((((((`detail_ambil_paket` join `master_jual_paket` on((`master_jual_paket`.`jpaket_id` = `detail_ambil_paket`.`dapaket_jpaket`))) left join `customer` on((`master_jual_paket`.`jpaket_cust` = `customer`.`cust_id`))) left join `paket` on((`detail_ambil_paket`.`dapaket_paket` = `paket`.`paket_id`))) left join `vu_jumlah_isi_paket` on((`detail_ambil_paket`.`dapaket_paket` = `vu_jumlah_isi_paket`.`paket_id`))) left join `vu_perawatan` on((`detail_ambil_paket`.`dapaket_item` = `vu_perawatan`.`rawat_id`))) left join `customer` `pemakai` on((`detail_ambil_paket`.`dapaket_cust` = `pemakai`.`cust_id`))) left join `tindakan_detail` on((`detail_ambil_paket`.`dapaket_dtrawat` = `tindakan_detail`.`dtrawat_id`))) left join `karyawan` `dokter` on((`tindakan_detail`.`dtrawat_petugas1` = `dokter`.`karyawan_id`))) left join `karyawan` `terapis` on((`tindakan_detail`.`dtrawat_petugas2` = `terapis`.`karyawan_id`))) left join `karyawan` `referal` on((`detail_ambil_paket`.`dapaket_referal` = `referal`.`karyawan_id`))) left join `detail_jual_paket` on((`detail_ambil_paket`.`dapaket_dpaket` = `detail_jual_paket`.`dpaket_id`))) order by `detail_ambil_paket`.`dapaket_date_create` desc);
