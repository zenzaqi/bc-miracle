



CREATE OR REPLACE VIEW `vu_detail_order_beli` AS select `master_order_beli`.`order_id` AS `order_id`,`supplier`.`supplier_nama` AS `supplier_nama`,`supplier`.`supplier_alamat` AS `supplier_alamat`,`supplier`.`supplier_kota` AS `supplier_kota`,`supplier`.`supplier_akun` AS `supplier_akun`,`master_order_beli`.`order_supplier` AS `order_supplier`,`master_order_beli`.`order_tanggal` AS `tanggal`,`master_order_beli`.`order_carabayar` AS `order_carabayar`,`master_order_beli`.`order_diskon` AS `order_diskon`,`master_order_beli`.`order_biaya` AS `order_biaya`,`master_order_beli`.`order_bayar` AS `order_bayar`,`master_order_beli`.`order_keterangan` AS `order_keterangan`,`detail_order_beli`.`dorder_id` AS `dorder_id`,`detail_order_beli`.`dorder_master` AS `dorder_master`,`detail_order_beli`.`dorder_produk` AS `dorder_produk`,`detail_order_beli`.`dorder_satuan` AS `dorder_satuan`,`detail_order_beli`.`dorder_jumlah` AS `jumlah_barang`,`detail_order_beli`.`dorder_harga` AS `harga_satuan`,`detail_order_beli`.`dorder_harga_log` AS `dorder_harga_log`,`detail_order_beli`.`dorder_diskon` AS `diskon`,`satuan`.`satuan_id` AS `satuan_id`,`satuan`.`satuan_kode` AS `satuan_kode`,`satuan`.`satuan_nama` AS `satuan_nama`,`vu_produk`.`produk_kode` AS `produk_kode`,`vu_produk`.`produk_group` AS `produk_group`,`vu_produk`.`produk_kategori` AS `produk_kategori`,`vu_produk`.`produk_kontribusi` AS `produk_kontribusi`,`vu_produk`.`produk_nama` AS `produk_nama`,`vu_produk`.`produk_satuan` AS `produk_satuan`,`vu_produk`.`produk_volume` AS `produk_volume`,`vu_produk`.`produk_jenis` AS `produk_jenis`,`vu_produk`.`produk_kodelama` AS `produk_kodelama`,`vu_produk`.`group_nama` AS `group_nama`,`vu_produk`.`kategori_nama` AS `kategori_nama`,`vu_produk`.`kategori_jenis` AS `kategori_jenis`,`vu_produk`.`jenis_nama` AS `jenis_nama`,`vu_produk`.`jenis_kelompok` AS `jenis_kelompok`,`vu_produk`.`kategori2_nama` AS `kategori2_nama`,(((`detail_order_beli`.`dorder_jumlah` * `detail_order_beli`.`dorder_diskon`) * `detail_order_beli`.`dorder_harga`) / 100) AS `diskon_nilai`,(((`detail_order_beli`.`dorder_jumlah` * `detail_order_beli`.`dorder_harga`) * (100 - `detail_order_beli`.`dorder_diskon`)) / 100) AS `subtotal`,`supplier`.`supplier_id` AS `supplier_id`,`master_order_beli`.`order_no` AS `no_bukti`,ifnull(`vu_detail_terima_order`.`jumlah_terima`,0) AS `jumlah_terima`,ifnull(`vu_detail_terima_order`.`jumlah_sisa`,0) AS `jumlah_sisa`,`master_order_beli`.`order_status` AS `order_status` from (((((`detail_order_beli` join `master_order_beli` on((`detail_order_beli`.`dorder_master` = `master_order_beli`.`order_id`))) join `supplier` on((`master_order_beli`.`order_supplier` = `supplier`.`supplier_id`))) join `satuan` on((`detail_order_beli`.`dorder_satuan` = `satuan`.`satuan_id`))) join `vu_produk` on((`detail_order_beli`.`dorder_produk` = `vu_produk`.`produk_id`))) join `vu_detail_terima_order` on(((`detail_order_beli`.`dorder_produk` = `vu_detail_terima_order`.`produk`) and (`detail_order_beli`.`dorder_master` = `vu_detail_terima_order`.`master_order`) and (`detail_order_beli`.`dorder_satuan` = `vu_detail_terima_order`.`satuan`))));



CREATE OR REPLACE VIEW `vu_detail_terima_order` AS select `mo`.`order_id` AS `master_order`,`mt`.`terima_id` AS `master_terima`,`do`.`dorder_produk` AS `produk`,`do`.`dorder_satuan` AS `satuan`,`do`.`dorder_jumlah` AS `jumlah_order`,`dt`.`dterima_jumlah` AS `jumlah_terima`,(`do`.`dorder_jumlah` - `dt`.`dterima_jumlah`) AS `jumlah_sisa`,`do`.`dorder_harga` AS `harga`,`do`.`dorder_diskon` AS `diskon`,`mt`.`terima_status` AS `terima_status` from (((`detail_order_beli` `do` join `master_order_beli` `mo`) join `detail_terima_beli` `dt`) join `master_terima_beli` `mt`) where ((`do`.`dorder_master` = `mo`.`order_id`) and (`dt`.`dterima_master` = `mt`.`terima_id`) and (`mt`.`terima_order` = `mo`.`order_id`) and (`do`.`dorder_produk` = `dt`.`dterima_produk`) and (`do`.`dorder_satuan` = `dt`.`dterima_satuan`)) union select `mo`.`order_id` AS `master_order`,0 AS `master_terima`,`do`.`dorder_produk` AS `produk`,`do`.`dorder_satuan` AS `satuan`,`do`.`dorder_jumlah` AS `jumlah_order`,0 AS `jumlah_terima`,`do`.`dorder_jumlah` AS `jumlah_sisa`,`do`.`dorder_harga` AS `harga`,`do`.`dorder_diskon` AS `diskon`,0 AS `terima_status` from (`detail_order_beli` `do` join `master_order_beli` `mo`) where ((`do`.`dorder_master` = `mo`.`order_id`) and (not((`do`.`dorder_produk`,`do`.`dorder_satuan`) in (select `dt`.`dterima_produk` AS `dterima_produk`,`dt`.`dterima_satuan` AS `dterima_satuan` from (`detail_terima_beli` `dt` join `master_terima_beli` `mt`) where ((`mt`.`terima_id` = `dt`.`dterima_master`) and (`mt`.`terima_order` = `mo`.`order_id`)))))) union select 0 AS `master_order`,`mt`.`terima_id` AS `master_terima`,`dt`.`dterima_produk` AS `produk`,`dt`.`dterima_satuan` AS `satuan`,0 AS `jumlah_order`,`dt`.`dterima_jumlah` AS `jumlah_terima`,-(`dt`.`dterima_jumlah`) AS `jumlah_sisa`,0 AS `harga`,0 AS `diskon`,`mt`.`terima_status` AS `terima_status` from (`detail_terima_beli` `dt` join `master_terima_beli` `mt`) where ((`mt`.`terima_id` = `dt`.`dterima_master`) and (not((`dt`.`dterima_produk`,`dt`.`dterima_satuan`) in (select `do`.`dorder_produk` AS `dorder_produk`,`do`.`dorder_satuan` AS `dorder_satuan` from (`master_order_beli` `mo` join `detail_order_beli` `do`) where ((`mo`.`order_id` = `do`.`dorder_master`) and (`mo`.`order_id` = `mt`.`terima_order`))))));


CREATE OR REPLACE VIEW `vu_detail_terima_produk` AS select `master_terima_beli`.`terima_order` AS `terima_order`,`master_terima_beli`.`terima_supplier` AS `terima_supplier`,`master_terima_beli`.`terima_status` AS `terima_status`,`master_terima_beli`.`terima_surat_jalan` AS `terima_surat_jalan`,`master_terima_beli`.`terima_pengirim` AS `terima_pengirim`,`master_terima_beli`.`terima_tanggal` AS `terima_tanggal`,`detail_terima_beli`.`dterima_master` AS `dterima_master`,`detail_terima_beli`.`dterima_produk` AS `dterima_produk`,`vu_produk`.`produk_kode` AS `produk_kode`,`vu_produk`.`produk_nama` AS `produk_nama`,`vu_produk`.`group_nama` AS `group_nama`,`vu_produk`.`jenis_nama` AS `jenis_nama`,`vu_produk`.`kategori2_nama` AS `kategori2_nama`,`satuan`.`satuan_kode` AS `satuan_kode`,`satuan`.`satuan_nama` AS `satuan_nama`,`detail_terima_beli`.`dterima_jumlah` AS `dterima_jumlah`,`detail_terima_beli`.`dterima_id` AS `dterima_id`,`detail_terima_beli`.`dterima_satuan` AS `dterima_satuan`,`supplier`.`supplier_id` AS `supplier_id`,`master_terima_beli`.`terima_no` AS `terima_no`,`supplier`.`supplier_akun` AS `supplier_akun`,`vu_produk`.`produk_id` AS `produk_id`,ifnull(`detail_order_beli`.`dorder_jumlah`,0) AS `jumlah_order`,ifnull(`detail_order_beli`.`dorder_harga`,0) AS `harga_satuan`,ifnull(`detail_order_beli`.`dorder_diskon`,0) AS `diskon`,ifnull((`detail_order_beli`.`dorder_harga` * `detail_terima_beli`.`dterima_jumlah`),0) AS `total_nilai`,ifnull((((`detail_order_beli`.`dorder_harga` * `detail_order_beli`.`dorder_diskon`) * `detail_terima_beli`.`dterima_jumlah`) / 100),0) AS `diskon_nilai`,ifnull((((`detail_order_beli`.`dorder_harga` * `detail_terima_beli`.`dterima_jumlah`) * (100 - `detail_order_beli`.`dorder_diskon`)) / 100),0) AS `subtotal`,`supplier`.`supplier_kategori` AS `supplier_kategori`,`supplier`.`supplier_nama` AS `supplier_nama`,`supplier`.`supplier_alamat` AS `supplier_alamat`,`satuan`.`satuan_id` AS `satuan_id`,`supplier`.`supplier_kota` AS `supplier_kota`,`vu_produk`.`produk_volume` AS `produk_volume`,`master_order_beli`.`order_no` AS `order_no`,(`detail_order_beli`.`dorder_jumlah` - (select sum(`detail_terima_beli`.`dterima_jumlah`) AS `sum(detail_terima_beli.dterima_jumlah)` from (`detail_terima_beli` left join `master_terima_beli` on((`master_terima_beli`.`terima_id` = `detail_terima_beli`.`dterima_master`))) where ((`master_terima_beli`.`terima_order` = `master_order_beli`.`order_id`) and (`master_terima_beli`.`terima_status` <> 'Batal') and (`detail_order_beli`.`dorder_produk` = `detail_terima_beli`.`dterima_produk`) and (`detail_order_beli`.`dorder_satuan` = `detail_terima_beli`.`dterima_satuan`)))) AS `jumlah_sisa` from ((((((`detail_terima_beli` left join `master_terima_beli` on((`detail_terima_beli`.`dterima_master` = `master_terima_beli`.`terima_id`))) left join `vu_produk` on((`vu_produk`.`produk_id` = `detail_terima_beli`.`dterima_produk`))) left join `satuan` on((`detail_terima_beli`.`dterima_satuan` = `satuan`.`satuan_id`))) left join `master_order_beli` on((`master_terima_beli`.`terima_order` = `master_order_beli`.`order_id`))) left join `detail_order_beli` on(((`detail_order_beli`.`dorder_master` = `master_order_beli`.`order_id`) and (`detail_order_beli`.`dorder_produk` = `detail_terima_beli`.`dterima_produk`) and (`detail_order_beli`.`dorder_satuan` = `detail_terima_beli`.`dterima_satuan`)))) left join `supplier` on((`master_terima_beli`.`terima_supplier` = `supplier`.`supplier_id`)));