DELIMITER //

CREATE OR REPLACE TRIGGER ins_cabin_rawat_satuan AFTER UPDATE ON master_jual_rawat FOR EACH ROW BEGIN  IF old.jrawat_stat_dok = 'Terbuka' and new.jrawat_stat_dok = 'Tertutup' THEN  insert into detail_pakai_cabin (cabin_rawat, cabin_produk, cabin_bukti, cabin_satuan, cabin_jumlah, cabin_gudang, cabin_cust)  SELECT perawatan.rawat_id   ,krawat_produk   ,master_jual_rawat.jrawat_nobukti   ,krawat_satuan   ,krawat_jumlah*detail_jual_rawat.drawat_jumlah   ,rawat_gudang   ,master_jual_rawat.jrawat_cust   FROM detail_jual_rawat   LEFT JOIN master_jual_rawat on (master_jual_rawat.jrawat_id = detail_jual_rawat.drawat_master)   LEFT JOIN perawatan_konsumsi on (perawatan_konsumsi.krawat_master = detail_jual_rawat.drawat_rawat)   LEFT JOIN produk ON(krawat_produk=produk_id)   LEFT JOIN perawatan ON(krawat_master=rawat_id)     WHERE master_jual_rawat.jrawat_id = OLD.jrawat_id AND produk_aktif='Aktif' ;  ELSEIF new.jrawat_stat_dok = 'Batal' THEN  delete from detail_pakai_cabin   WHERE cabin_bukti = old.jrawat_nobukti and cabin_cust = old.jrawat_cust    ;   END IF;  END;


CREATE OR REPLACE TRIGGER ins_cabin_ambil_paket AFTER UPDATE ON detail_ambil_paket FOR EACH ROW BEGIN IF old.dapaket_stat_dok = 'Terbuka' and new.dapaket_stat_dok = 'Tertutup' THEN  insert into detail_pakai_cabin (cabin_rawat, cabin_produk, cabin_bukti, cabin_dapaket_id, cabin_satuan, cabin_jumlah, cabin_gudang, cabin_cust)  SELECT perawatan.rawat_id   ,krawat_produk   ,master_jual_paket.jpaket_nobukti   ,detail_ambil_paket.dapaket_id   ,krawat_satuan   ,krawat_jumlah*detail_ambil_paket.dapaket_jumlah   ,rawat_gudang   ,master_jual_paket.jpaket_cust   FROM detail_ambil_paket   LEFT JOIN master_jual_paket on (master_jual_paket.jpaket_id= detail_ambil_paket.dapaket_jpaket)   LEFT JOIN perawatan_konsumsi on (perawatan_konsumsi.krawat_master = detail_ambil_paket.dapaket_item)   LEFT JOIN produk ON(krawat_produk=produk_id)   LEFT JOIN perawatan ON(krawat_master=rawat_id)     WHERE detail_ambil_paket.dapaket_id = old.dapaket_id AND produk_aktif='Aktif' ;  ELSEIF new.dapaket_stat_dok = 'Batal' or new.dapaket_stat_dok = 'Adj' THEN  delete from detail_pakai_cabin   WHERE cabin_dapaket_id = old.dapaket_id ;   END IF; END;

DELIMITER ;