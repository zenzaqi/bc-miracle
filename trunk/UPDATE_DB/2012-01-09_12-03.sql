/*nambah cashback_medis dan voucher_medis*/

CREATE OR REPLACE VIEW `vu_detail_jual_paket` AS (select `detail_jual_paket`.`dpaket_master` AS `dpaket_master`,`detail_jual_paket`.`dpaket_paket` AS `dpaket_paket`,`paket`.`paket_nama` AS `produk_nama`,`kategori2`.`kategori2_nama` AS `kategori2_nama`,`detail_jual_paket`.`dpaket_jumlah` AS `jumlah_barang`,`detail_jual_paket`.`dpaket_harga` AS `harga_satuan`,`detail_jual_paket`.`dpaket_diskon` AS `dpaket_diskon`,if((ifnull(`detail_jual_paket`.`dpaket_diskon_jenis`,_latin1'-') = _latin1''),_latin1'-',ifnull(`detail_jual_paket`.`dpaket_diskon_jenis`,_latin1'-')) AS `diskon_jenis`,if((ifnull(`karyawan`.`karyawan_username`,_latin1'-') = _latin1''),_latin1'-',ifnull(`karyawan`.`karyawan_username`,_latin1'-')) AS `sales`,`master_jual_paket`.`jpaket_nobukti` AS `no_bukti`,`master_jual_paket`.`jpaket_cust` AS `jpaket_cust`,`master_jual_paket`.`jpaket_diskon` AS `diskon_umum`,`master_jual_paket`.`jpaket_cashback` AS `voucher`,`master_jual_paket`.`jpaket_cashback_medis` AS `voucher_medis`,`master_jual_paket`.`jpaket_totalbiaya` AS `totalbiaya`,`master_jual_paket`.`jpaket_bayar` AS `bayar`,`customer`.`cust_member` AS `cust_member`,`customer`.`cust_nama` AS `cust_nama`,`customer`.`cust_no` AS `cust_no`,`customer`.`cust_kelamin` AS `cust_kelamin`,`customer`.`cust_alamat` AS `cust_alamat`,`customer`.`cust_kota` AS `cust_kota`,`paket`.`paket_kode` AS `produk_kode`,_utf8'paket' AS `satuan_nama`,`detail_jual_paket`.`dpaket_diskon` AS `diskon`,(((`detail_jual_paket`.`dpaket_harga` * `detail_jual_paket`.`dpaket_jumlah`) * `detail_jual_paket`.`dpaket_diskon`) / 100) AS `diskon_nilai`,if((`master_jual_paket`.`jpaket_stat_dok` = _latin1'Batal'),0,((`detail_jual_paket`.`dpaket_harga` * `detail_jual_paket`.`dpaket_jumlah`) - (((`detail_jual_paket`.`dpaket_harga` * `detail_jual_paket`.`dpaket_jumlah`) * `detail_jual_paket`.`dpaket_diskon`) / 100))) AS `subtotal`,`master_jual_paket`.`jpaket_tanggal` AS `tanggal`,`customer`.`cust_id` AS `cust_id`,`master_jual_paket`.`jpaket_stat_dok` AS `jpaket_stat_dok`,`master_jual_paket`.`jpaket_stat_dok` AS `status`,`master_jual_paket`.`jpaket_keterangan` AS `keterangan`,`paket`.`paket_id` AS `produk_id`,`vu_sum_jual_card`.`jcard_nilai` AS `bayar_card`,`vu_sum_jual_cek`.`jcek_nilai` AS `bayar_cek`,`vu_sum_jual_kwitansi`.`jkwitansi_nilai` AS `bayar_kuitansi`,`vu_sum_jual_transfer`.`jtransfer_nilai` AS `bayar_transfer`,`vu_sum_jual_tunai`.`jtunai_nilai` AS `bayar_tunai`,cast(`master_jual_paket`.`jpaket_date_create` as time) AS `time` from ((((((((((`detail_jual_paket` left join `master_jual_paket` on((`detail_jual_paket`.`dpaket_master` = `master_jual_paket`.`jpaket_id`))) left join `customer` on((`master_jual_paket`.`jpaket_cust` = `customer`.`cust_id`))) left join `paket` on((`detail_jual_paket`.`dpaket_paket` = `paket`.`paket_id`))) left join `kategori2` on((`paket`.`paket_kontribusi` = `kategori2`.`kategori2_id`))) left join `vu_sum_jual_card` on((`vu_sum_jual_card`.`jcard_ref` = `master_jual_paket`.`jpaket_nobukti`))) left join `vu_sum_jual_cek` on((`vu_sum_jual_cek`.`jcek_ref` = `master_jual_paket`.`jpaket_nobukti`))) left join `vu_sum_jual_kwitansi` on((`vu_sum_jual_kwitansi`.`jkwitansi_ref` = `master_jual_paket`.`jpaket_nobukti`))) left join `vu_sum_jual_transfer` on((`vu_sum_jual_transfer`.`jtransfer_ref` = `master_jual_paket`.`jpaket_nobukti`))) left join `vu_sum_jual_tunai` on((`vu_sum_jual_tunai`.`jtunai_ref` = `master_jual_paket`.`jpaket_nobukti`))) left join `karyawan` on((`detail_jual_paket`.`dpaket_karyawan` = `karyawan`.`karyawan_id`))));

--
-- VIEW  `vu_detail_jual_paket`
-- Data: None
--
CREATE OR REPLACE VIEW `vu_trans_paket` AS select `master_jual_paket`.`jpaket_nobukti` AS `no_bukti`,`master_jual_paket`.`jpaket_cust` AS `cust_id`,`master_jual_paket`.`jpaket_tanggal` AS `tanggal`,`vu_customer`.`cust_no` AS `cust_no`,`vu_customer`.`cust_member` AS `cust_member`,`vu_customer`.`cust_nama` AS `cust_nama`,`vu_customer`.`cust_kelamin` AS `cust_kelamin`,`vu_customer`.`cust_alamat` AS `cust_alamat`,`vu_customer`.`cust_kota` AS `cust_kota`,ifnull(`vu_total_jual_paket_group`.`jumlah_barang`,0) AS `jumlah_barang`,ifnull(`vu_total_jual_paket_group`.`total_nilai`,0) AS `total_nilai`,`master_jual_paket`.`jpaket_bayar` AS `total_bayar`,ifnull(`master_jual_paket`.`jpaket_diskon`,0) AS `diskon`,ifnull(`master_jual_paket`.`jpaket_cashback`,0) AS `cashback`,ifnull(`master_jual_paket`.`jpaket_cashback_medis`,0) AS `cashback_medis`,ifnull(`master_lunas_piutang`.`lpiutang_total`,0) AS `kredit`,ifnull(`vu_sum_jual_cek`.`jcek_nilai`,0) AS `cek`,ifnull(`vu_sum_jual_card`.`jcard_nilai`,0) AS `card`,ifnull(`vu_sum_jual_kwitansi`.`jkwitansi_nilai`,0) AS `kuitansi`,ifnull(`vu_sum_jual_transfer`.`jtransfer_nilai`,0) AS `transfer`,ifnull(`vu_sum_jual_tunai`.`jtunai_nilai`,0) AS `tunai`,ifnull(`vu_sum_jual_voucher`.`tvoucher_nilai`,0) AS `voucher`,`master_jual_paket`.`jpaket_stat_dok` AS `jpaket_stat_dok` from (((((((((`master_jual_paket` left join `vu_total_jual_paket_group` on((`vu_total_jual_paket_group`.`dpaket_master` = `master_jual_paket`.`jpaket_id`))) left join `vu_customer` on((`master_jual_paket`.`jpaket_cust` = `vu_customer`.`cust_id`))) left join `vu_sum_jual_card` on((`vu_sum_jual_card`.`jcard_ref` = `master_jual_paket`.`jpaket_nobukti`))) left join `vu_sum_jual_cek` on((`vu_sum_jual_cek`.`jcek_ref` = `master_jual_paket`.`jpaket_nobukti`))) left join `master_lunas_piutang` on((`master_lunas_piutang`.`lpiutang_faktur` = `master_jual_paket`.`jpaket_nobukti`))) left join `vu_sum_jual_kwitansi` on((`vu_sum_jual_kwitansi`.`jkwitansi_ref` = `master_jual_paket`.`jpaket_nobukti`))) left join `vu_sum_jual_transfer` on((`vu_sum_jual_transfer`.`jtransfer_ref` = `master_jual_paket`.`jpaket_nobukti`))) left join `vu_sum_jual_tunai` on((`vu_sum_jual_tunai`.`jtunai_ref` = `master_jual_paket`.`jpaket_nobukti`))) left join `vu_sum_jual_voucher` on((`vu_sum_jual_voucher`.`tvoucher_ref` = `master_jual_paket`.`jpaket_nobukti`)));

--
-- VIEW  `vu_trans_paket`
-- Data: None
--


